name: Build dflat linux [tmate]
on: [workflow_dispatch]

jobs:
  build:
    name: Run Script
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Setup tmate session
      uses: mxschmitt/action-tmate@v3
      with:
        limit-access-to-actor: true
        detached: true
    - name: Run assemble script
      run: | 
        chmod +x assemble-linux.sh
        ./assemble-linux.sh
      shell: bash
    - name: Get latest release tag
      id: latest_release
      run: |
        LATEST_TAG=$(gh release list --limit 1 --json tagName --jq '.[0].tagName')
        echo "tag=$LATEST_TAG" >> $GITHUB_OUTPUT
        echo "Latest release tag: $LATEST_TAG"
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    - uses: ncipollo/release-action@v1
      with:
        artifacts: dflat-linux-x64.tar.gz
        tag: ${{ steps.latest_release.outputs.tag }}
